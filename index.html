<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="author" content="Priyanko Manna" />
    <meta name="description" content="‡¶™‡ßÅ‡¶≤‡¶∏‡¶ø‡¶ü‡¶æ ‡¶π‡¶æ‡¶Å‡¶∏‡¶ø ‡¶ñ‡ßÅ‡¶∂‡¶ø ‚Äî ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡¶æ‡¶≤ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏, ‡¶™‡¶£‡ßç‡¶Ø ‡¶ì ‡¶¨‡ßç‡¶≤‡¶ó" />
    <title>The Informal || Khola Pata || Hasi Kushi Store</title>

    <!-- Fonts & Tailwind CDN -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Rajdhani:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Marked (markdown parser) + DOMPurify (sanitize) -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@2.4.0/dist/purify.min.js"></script>

    <style>
        :root{--neon-cyan: #00ffe7;--neon-mag: #ff00f7;--card-bg: rgba(255,255,255,0.03);}
        body{font-family: 'Rajdhani', sans-serif;background: radial-gradient(circle at 10% 10%, #071026 0%, #081827 20%, #071a2b 45%, #081a29 100%);color: #e6f7ff;-webkit-font-smoothing:antialiased;}
        header{ font-family:'Orbitron',sans-serif; }
        .glow-card{background: var(--card-bg);border: 1px solid rgba(0,255,235,0.08);backdrop-filter: blur(6px);transition: transform .25s, box-shadow .25s;}
        .glow-card:hover{ transform: translateY(-6px); box-shadow: 0 12px 30px rgba(0,255,235,0.06);}
        .glow-btn{background: linear-gradient(135deg,var(--neon-cyan),#0077ff);color:#021020; padding:.6rem 1.1rem; border-radius:9999px; font-weight:700;}
        .glow-btn:hover{ box-shadow: 0 8px 34px rgba(0,255,235,0.12); transform: translateY(-2px);}
        .reader-backdrop{ background: linear-gradient(180deg, rgba(3,6,12,0.6), rgba(1,4,7,0.85)); }
        .post-body h1{font-family:'Orbitron'; font-size:1.5rem; color:var(--neon-cyan);}
        .post-body h2{font-family:'Orbitron'; color:#9be7ff;}
        .post-body a{color: #ffd1ff; text-decoration: underline;}
        .post-body code{background: rgba(255,255,255,0.03);padding: 2px 6px;border-radius:6px;color:#f0f0f0;}
        .nebula {position: fixed; inset:0; z-index:-1; pointer-events:none;background-image:radial-gradient(circle at 20% 10%, rgba(255,0,200,0.06) 0 8%, transparent 20%),radial-gradient(circle at 80% 80%, rgba(0,200,255,0.04) 0 12%, transparent 30%),radial-gradient(circle at 50% 40%, rgba(100,80,255,0.03) 0 6%, transparent 16%);mix-blend-mode: screen;filter: blur(30px) saturate(120%);opacity: 0.9;}
        html.dark body{background: radial-gradient(circle at 10% 10%, #070d18 0%, #081018 20%, #07131b 45%, #08121a 100%);color: #bbf7d0;}
        /* small responsive tweaks for reader */
        @media (max-width: 640px){
          .post-body h1{font-size:1.25rem;}
        }
    </style>
</head>

<!-- sitePosts should be available before app script; you can place it in a separate file or inline -->
<script>
    window.sitePosts = [
      { file: "posts/demo.md", title: "‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ ‚Äî ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡ßç‡¶≤‡¶ó", date: "2025-09-13" },
      { file: "posts/nepal.md", title: "‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡¶æ‡¶≤ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶®‡ßá‡¶ì‡ßü‡¶æ‡¶∞ ‡¶∏‡¶π‡¶ú ‡¶â‡¶™‡¶æ‡ßü", date: "2025-09-10" },
      { file: "posts/welcome-post.md", title: "‡¶ú‡ßá‡¶∞‡¶ï‡ßç‡¶∏ ‡¶¨‡¶®‡¶æ‡¶Æ ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü ‚Äî ‡¶ï‡ßã‡¶®‡¶ü‡¶æ ‡¶¨‡ßá‡¶õ‡ßá ‡¶®‡ßá‡¶¨‡ßá‡¶®?", date: "2025-09-07" }
    ];
</script>

<body class="min-h-screen flex flex-col">

<div class="nebula"></div>

<header class="text-center py-8 px-4">
    <h1 class="text-4xl font-bold tracking-wider text-cyan-200">‡¶™‡ßÅ‡¶≤‡¶∏‡¶ø‡¶ü‡¶æ ‡¶π‡¶æ‡¶Å‡¶∏‡¶ø ‡¶ñ‡ßÅ‡¶∂‡¶ø ‡¶ú‡ßá‡¶∞‡¶ï‡ßç‡¶∏</h1>
    <p class="text-gray-300 text-lg mt-1">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡¶æ‡¶≤ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏, ‡¶™‡¶£‡ßç‡¶Ø ‡¶ì ‡¶¨‡ßç‡¶≤‡¶ó ‚Äî ‡¶∏‡¶¨ ‡¶è‡¶ï ‡¶ú‡¶æ‡¶Ø‡¶º‡¶ó‡¶æ‡¶Ø‡¶º</p>
    <div class="mt-5 flex justify-center gap-4">
        <a href="#shop" class="glow-btn">üõí ‡¶¶‡ßã‡¶ï‡¶æ‡¶®</a>
        <a href="#blog" class="glow-btn">üìù ‡¶¨‡ßç‡¶≤‡¶ó</a>
        <button id="themeToggle" class="glow-btn ml-2" type="button" aria-pressed="false">üåó ‡¶•‡¶ø‡¶Æ</button>
    </div>
</header>

<main class="flex-1">
    <section id="services" class="p-6 max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="glow-card p-5 rounded-2xl" role="article" aria-label="Aadhaar service">
            <h2 class="text-xl text-cyan-300">Aadhaar</h2>
            <p class="text-sm text-gray-300">Enrollment & Update</p>
        </div>
        <div class="glow-card p-5 rounded-2xl" role="article" aria-label="PAN service">
            <h2 class="text-xl text-cyan-300">PAN</h2>
            <p class="text-sm text-gray-300">Card Application</p>
        </div>
        <div class="glow-card p-5 rounded-2xl" role="article" aria-label="Recharge">
            <h2 class="text-xl text-cyan-300">Recharge</h2>
            <p class="text-sm text-gray-300">Mobile & DTH</p>
        </div>
    </section>

    <section id="shop" class="p-6 max-w-6xl mx-auto mt-4">
        <h2 class="text-2xl mb-4 text-purple-300">üõçÔ∏è Shop Products</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="glow-card p-4 rounded-2xl">
                <h3 class="text-lg">Aadhaar Form Bundle</h3>
                <p class="text-sm text-gray-300">Printed Aadhaar forms + guidance</p>
                <div class="mt-3 flex items-center justify-between">
                    <div class="text-cyan-200 font-bold">‚Çπ49</div>
                    <button class="glow-btn">Add</button>
                </div>
            </div>
            <div class="glow-card p-4 rounded-2xl">
                <h3 class="text-lg">PAN Application Kit</h3>
                <p class="text-sm text-gray-300">PAN form + scanning service</p>
                <div class="mt-3 flex items-center justify-between">
                    <div class="text-cyan-200 font-bold">‚Çπ99</div>
                    <button class="glow-btn">Add</button>
                </div>
            </div>
            <div class="glow-card p-4 rounded-2xl">
                <h3 class="text-lg">Xerox Pack (50 pages)</h3>
                <p class="text-sm text-gray-300">High quality mono xerox</p>
                <div class="mt-3 flex items-center justify-between">
                    <div class="text-cyan-200 font-bold">‚Çπ120</div>
                    <button class="glow-btn">Add</button>
                </div>
            </div>
        </div>
    </section>

    <section id="blog" class="p-6 max-w-6xl mx-auto mt-8">
        <div class="flex items-center justify-between mb-4">
            <h2 class="text-2xl text-green-300">üì° Latest Blog Posts</h2>
            <div class="flex gap-3 items-center">
                <label for="search" class="sr-only">Search posts</label>
                <input id="search" class="px-3 py-2 rounded-lg bg-transparent border border-cyan-700 text-sm text-gray-200" placeholder="Search posts..." />
                <label for="sort" class="sr-only">Sort posts</label>
                <select id="sort" class="px-3 py-2 rounded-lg bg-transparent border border-cyan-700 text-sm text-gray-200">
                    <option value="new">Newest first</option>
                    <option value="old">Oldest first</option>
                </select>
            </div>
        </div>
        <div id="postsList" class="grid grid-cols-1 md:grid-cols-2 gap-4" aria-live="polite"></div>
    </section>
</main>

<!-- Reader modal -->
<div id="reader" class="fixed inset-0 z-50 hidden items-center justify-center p-6" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="absolute inset-0 reader-backdrop opacity-95" onclick="closeReader()"></div>
    <div class="relative max-w-3xl w-full bg-gradient-to-b from-[#04121b] to-[#03131b] rounded-2xl p-6 glow-card text-gray-100 overflow-auto" style="max-height:90vh;">
        <div class="flex items-start justify-between gap-4">
            <div>
                <h3 id="readerTitle" class="text-2xl font-bold"></h3>
                <div id="readerDate" class="text-sm text-gray-400 mt-1"></div>
            </div>
            <div class="ml-auto flex gap-2">
                <button class="px-3 py-2 rounded-lg border border-cyan-700 text-sm" onclick="toggleTheme()">Theme</button>
                <button class="px-3 py-2 rounded-lg border border-cyan-700 text-sm" onclick="closeReader()">Close</button>
            </div>
        </div>
        <hr class="my-4 border-cyan-800" />
        <article id="readerBody" class="post-body prose prose-invert max-w-none"></article>
    </div>
</div>
<section className="container mx-auto my-12 px-4">
    <h2 className="text-3xl mb-6 font-semibold">‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ YouTube ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</h2>
    <YoutubeFeed channelId="YOUR_YOUTUBE_CHANNEL_ID" apiKey="YOUR_YOUTUBE_API_KEY" />
</section>
<footer class="mt-12 p-6 text-center border-t border-cyan-700">
    <p>üìß <a href="mailto:mtpl.kolaghat@gmail.com" class="text-cyan-200">mtpl.kolaghat@gmail.com</a> | üìû <a href="tel:+918967744210" class="text-cyan-200">+91-8967744210</a></p>
    <p>üìç Kolaghat, West Bengal 721154</p>
    <p class="text-gray-500 mt-2">¬© 2025 ‡¶π‡¶æ‡¶Å‡¶∏‡¶ø ‡¶ñ‡ßÅ‡¶∂‡¶ø ‚Äî Powered by ‡¶ñ‡ßã‡¶≤‡¶æ‡¶™‡¶æ‡¶§‡¶æ</p>
</footer>

<script>
    /* -------------------------
       Utility & theme handling
       ------------------------- */
    function applyTheme(){
      let savedTheme = localStorage.getItem("theme");
      const prefersDark = window.matchMedia("(prefers-color-scheme: dark)");
      function setTheme(prefEvent){
        let theme = savedTheme;
        if(!theme){
          theme = (prefEvent ? prefEvent.matches : prefersDark.matches) ? "dark" : "light";
        }
        document.documentElement.classList.toggle("dark", theme === "dark");
        document.documentElement.setAttribute("data-theme", theme);
        const btn = document.getElementById('themeToggle');
        if(btn) btn.setAttribute('aria-pressed', theme === 'dark' ? 'true' : 'false');
      }
      setTheme();
      prefersDark.addEventListener("change", setTheme);
    }
    function toggleTheme(){
      const isDark = document.documentElement.classList.contains("dark");
      if(isDark){
        document.documentElement.classList.remove("dark");
        document.documentElement.setAttribute("data-theme", "light");
        localStorage.setItem("theme","light");
        document.getElementById('themeToggle')?.setAttribute('aria-pressed','false');
      } else {
        document.documentElement.classList.add("dark");
        document.documentElement.setAttribute("data-theme", "dark");
        localStorage.setItem("theme","dark");
        document.getElementById('themeToggle')?.setAttribute('aria-pressed','true');
      }
    }

    /* -------------------------
       Posts system (fetch + render)
       ------------------------- */
    const _defaultPosts = [{ file: "posts/demo.md", title: "Welcome Post", date: "2025-09-13" }];

    // prefer window.sitePosts if available
    const POSTS = Array.isArray(window.sitePosts) ? window.sitePosts : (Array.isArray(window.posts) ? window.posts : _defaultPosts);

    async function fetchMarkdown(path){
      try{
        const res = await fetch(path, { cache: "no-store" });
        if(!res.ok) return `# Error\nCould not load ${path} (status ${res.status})`;
        return await res.text();
      } catch(err){
        return `# Error\nNetwork error loading ${path}\n\n${err.message}`;
      }
    }

    /* safe markdown -> html using marked + DOMPurify */
    function mdToSanitizedHtml(md){
      try{
        const rawHtml = marked.parse(md || "");
        const clean = DOMPurify.sanitize(rawHtml, {ALLOWED_TAGS: false});
        return clean;
      } catch(e){
        return `<pre>${escapeHtml(String(e.message || e))}</pre>`;
      }
    }

    function escapeHtml(str){
      return String(str).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
    }

    function fmtDate(d){
      try{
        // normalize date-only values
        const dt = new Date(d + "T00:00:00");
        return dt.toLocaleDateString('bn-IN', { year:'numeric', month:'short', day:'numeric' });
      } catch(e){
        return d;
      }
    }

    async function renderPosts(){
      const container = document.getElementById('postsList');
      if(!container) return;
      container.innerHTML = '<div class="col-span-full text-gray-400">Loading posts...</div>';

      // fetch all raw markdown in parallel
      const enhanced = await Promise.all(POSTS.map(async p => {
        const raw = await fetchMarkdown(p.file);
        // keep original object safe
        return { ...p, raw: raw || "" };
      }));

      // store cache
      window.__postsCache = enhanced;

      const searchInput = document.getElementById('search');
      const sortSelect = document.getElementById('sort');

      function update(){
        const q = (searchInput?.value || "").trim().toLowerCase();
        const sort = sortSelect?.value || "new";
        let list = enhanced.slice();

        if(q){
          list = list.filter(item => {
            const hay = (item.title + " " + (item.raw || "") ).toLowerCase();
            return hay.includes(q);
          });
        }

        list.sort((a,b) => sort === 'new' ? new Date(b.date) - new Date(a.date) : new Date(a.date) - new Date(b.date));

        if(list.length === 0){
          container.innerHTML = '<div class="text-gray-400">‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶Æ‡¶ø‡¶≤‡¶≤ ‡¶®‡¶æ‡•§</div>';
          return;
        }

        container.innerHTML = '';
        list.forEach(item => {
          const excerptText = (item.raw || "").replace(/\s+/g,' ').replace(/[#_*`>-\[\]]/g,'').trim();
          const excerpt = excerptText.slice(0, 220) + (excerptText.length > 220 ? '...' : '');

          const card = document.createElement('div');
          card.className = 'glow-card p-4 rounded-2xl cursor-pointer';
          card.innerHTML = `
            <div class="flex items-start justify-between gap-3">
              <div>
                <h3 class="text-lg font-semibold text-cyan-100">${escapeHtml(item.title)}</h3>
                <div class="text-sm text-gray-400 mt-1">${fmtDate(item.date)}</div>
                <p class="text-sm text-gray-300 mt-3">${escapeHtml(excerpt)}</p>
              </div>
              <div class="flex flex-col items-end gap-2">
                <button class="glow-btn" data-file="${escapeHtml(item.file)}" aria-label="Read ${escapeHtml(item.title)}">Read</button>
              </div>
            </div>
          `;
          // button click
          const btn = card.querySelector('button');
          btn?.addEventListener('click', (ev)=>{
            ev.stopPropagation();
            openReader(item, true);
          });
          // whole card click
          card.addEventListener('click', ()=> openReader(item, true));
          container.appendChild(card);
        });
      }

      searchInput?.addEventListener('input', debounce(update, 200));
      sortSelect?.addEventListener('change', update);

      update();

      // If URL has ?post=... open it
      const urlPost = getUrlPostParam();
      if(urlPost){
        const found = enhanced.find(p => encodeURIComponent(p.file) === urlPost || encodeURIComponent(p.title) === urlPost);
        if(found) openReader(found, false, true);
      }
    }

    /* URL param helpers */
    function setUrlPostParam(encoded, replace=false){
      try{
        const url = new URL(window.location.href);
        if(encoded){
          url.searchParams.set('post', encoded);
        } else {
          url.searchParams.delete('post');
        }
        if(replace){
          history.replaceState({post: encoded}, '', url);
        } else {
          history.pushState({post: encoded}, '', url);
        }
      }catch(e){}
    }
    function getUrlPostParam(){
      try{
        const url = new URL(window.location.href);
        const p = url.searchParams.get('post');
        return p ? p : null;
      }catch(e){ return null; }
    }

    /* Reader open/close */
    function openReader(item, pushUrl=true, replaceOnly=false){
      const reader = document.getElementById('reader');
      document.getElementById('readerTitle').textContent = item.title;
      document.getElementById('readerDate').textContent = fmtDate(item.date);

      // convert markdown -> html (sanitize)
      const html = mdToSanitizedHtml(item.raw || "");
      document.getElementById('readerBody').innerHTML = html;

      reader.classList.remove('hidden');
      reader.style.display = 'flex';
      reader.setAttribute('aria-hidden','false');
      document.body.style.overflow = 'hidden';

      const encoded = encodeURIComponent(item.file);
      if(pushUrl){
        setUrlPostParam(encoded, replaceOnly);
      } else {
        setUrlPostParam(encoded, true);
      }
    }

    function closeReader(pushUrl=true){
      const reader = document.getElementById('reader');
      reader.classList.add('hidden');
      reader.style.display = 'none';
      reader.setAttribute('aria-hidden','true');
      document.body.style.overflow = '';
      if(pushUrl){
        setUrlPostParam('', false);
      } else {
        setUrlPostParam('', true);
      }
    }

    /* popstate -> open/close based on param */
    window.addEventListener('popstate', (ev) => {
      const p = getUrlPostParam();
      const cached = window.__postsCache || [];
      if(p){
        const found = cached.find(x => encodeURIComponent(x.file) === p || encodeURIComponent(x.title) === p);
        if(found){
          openReader(found, false, true);
          return;
        }
        try{
          const decoded = decodeURIComponent(p);
          const match = cached.find(x => x.file === decoded || x.title === decoded);
          if(match) openReader(match, false, true);
        } catch(e){}
      } else {
        const reader = document.getElementById('reader');
        if(reader && !reader.classList.contains('hidden')) closeReader(false);
      }
    });

    /* small helper: debounce */
    function debounce(fn, wait){
      let t;
      return function(...args){
        clearTimeout(t);
        t = setTimeout(()=> fn.apply(this,args), wait);
      };
    }

    /* ESC to close reader */
    document.addEventListener('keydown', (e)=> {
      if(e.key === 'Escape') {
        const reader = document.getElementById('reader');
        if(reader && !reader.classList.contains('hidden')) closeReader();
      }
    });

    /* initial boot */
    document.addEventListener('DOMContentLoaded', ()=>{
      applyTheme();
      document.getElementById('themeToggle')?.addEventListener('click', toggleTheme);
      renderPosts();
    });
</script>

</body>
</html>
